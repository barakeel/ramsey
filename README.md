This repository contains the software accompanying the paper 
"A formal proof of Ramsey(4,5)=24". 

## Install
The following installation instructions are for the Ubuntu OS.


### Install dependencies: polyml + HOL4
This takes about 15 min to complete. The first following command is optional.
``` 
sudo apt install -y libgmp-dev rlwrap
sh install_dep.sh
```

From now on, the scripts are found and run in the `src` directory.

``` 
cd src
```

### Install ramsey
Compute dependencies between SML files: `sh install.sh`
If one updates the repository (`git pull`), 
the command `sh install.sh` needs to be run again.

### Running HOL4
- Start: `sh hol.sh`
- Exit: `ctrl + D`

## Verifying the proof in HOL4
Please edit the config file: 
- choose and appropriate number of cores, 
  typically half of the number given by `lscpu` but this also depends your 
  available RAM (default is 40).
- memory per core in megabyte (default is 8000)
- maximum number of holes in a generalization (default is 10)
  Decreasing this number to 8 will require less memory and RAM 
  at the cost of being slower.

The creation of a HOL4 proof is divided in multiple steps: 
enumeration, cone, glueing proof, definition, enumeration proof, cone proof.

### Enumeration (10 min)
Enumeration of all the ramsey 4,4 graphs (R(4,4,k)) 
and all ramsey 3,5 graphs (R(3,5,k)) up to isomorphism.

Execute in HOL:
```
load "enum"; open sat aiLib graph enum;
disable_log := true;
enum (4,4);
enum (3,5);
```

The results are stored in the directory `enum`.
They can be read using the function `enum.read_enum`.


### Generalization skip (2 hours)
Please use extract the gen.tar for replicability.
If you want to create your own covers, please follow the instruction
of the next paragraph otherwise skip to the paragraph "Definition".

### Generalization (2 hours)
For each set R(3,5,k) (resp. (R(4,4,k)), we consturct a set of 
graph generalizations G(3,5,k) (resp. (G(4,4,k)) with the following code.

Execute in HOL:
```
load "gen"; open sat aiLib kernel graph gen;
erase_file (selfdir ^ "/gen/gen4418");
erase_file (selfdir ^ "/gen/gen3514");
select_number1 := 313;
select_number2 := 1;
val (_,t35) = add_time (gen (3,5)) (5,13);
select_number1 := 1000;
select_number2 := 100;
val (_,t44) = add_time (gen (4,4)) (4,17);
```

The results are stored in the directory `gen`. 
They can be read using the function `gen.read_cover`.

Better covers are uses for k=8,10,12, to generate those covers, run 
(this will overwrite the cover generated by the previous algortihms):




### Definition (10 min)

```
cd def
../../HOL/bin/Holmake 
```

### Proving the enumeration (1 hour)
First we create the proof scripts by running `sh hol.sh`:

```
load "enump"; open kernel enump;
val _ = range (8, 18, fn size => write_enumscripts 50 size (4,4));
```

Run the scripts (requires 500GB of ram) 
preferably inside a screen `screen -S enum`:
```
cd enump
../../HOL/bin/Holmake --no_prereqs -j 40 | tee ../aaa_log_enump
```

This creates low-level lemmas for the difficult case that need to combined.
The final proof of the enumeration of 3,5,k graphs and 4,4,k graphs
is obtained by running:

Create the final enumeration script by running `sh hol.sh`:

```
load "enump"; open enump;
write_enumfinalscript ();
```

Then, run the script:
```
cd enumf
../../HOL/bin/Holmake --no_prereqs
```

### Gluing (40 days)
Run from the `src` directory (preferably inside a screen `screen -S glue`):
```
cd glue
```

To be run at most one hour after starting the previous process,
remove empty temporary files (preferably inside a screen `screen -S tmp`).
This is unsafe if you have another process using files named `/tmp/MLTEMP*`.
```
cd /tmp
watch -n 600 "find . -maxdepth 1 -type f -name 'MLTEMP*' ! -exec lsof {} \; -exec rm {} \;"
```

## Merging the gluing lemmas
``
cd merge
../../HOL/bin/Holmake --no_prereqs
``




